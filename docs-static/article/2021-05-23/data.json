{"2021-05-23":"# NgRxを使用する。\n\n## install\n```bash\nng add @ngrx/store@latest\n```\n\n```bash\nnpm install -D @ngrx/schematics\nng config cli.defaultCollection @ngrx/schematics\n```\n\n`app.module.ts` に上書きが入る。\n```typescript\n...\nimport { StoreModule } from '@ngrx/store';\n\n@NgModule({\n  ...\n  imports: [\n    ...\n    StoreModule.forRoot({}, {})\n  ],\n  ...\n})\nexport class AppModule { }\n```\n\n\n## 概要\n\nNgRxのライフサイクルは以下の通り  \n![NgRx01](./assets/img/2021/05/23/01.png)\n\n\n`store` にある物を `Action` で `reducer` で処理し `selector` で取得するといった感じ。間にRxJsが入っているのでストリームとして受け取ることができる優れもの。\n\nまずはこのブログで使っている[BreadcrumbService](https://github.com/eeenbnb/karaage-ng-site/blob/master/src/app/service/breadcrumb/breadcrumb.service.ts)をNgRX化する。\n\n## state を定義する\n```typescript\nimport { KaraageBreadcrumbs } from 'src/@types/karaage-breadcrumb';\n\nexport interface BreadcrumbsState {\n  breadcrumbs: KaraageBreadcrumbs;\n}\n```\n\n## Actionを定義する\n\n```typescript\nimport { createAction, props } from '@ngrx/store';\nimport { BreadcrumbsState } from './breadcrumb.state'\n\nexport const setBreadcrumbs = createAction(\n  '[breadcrumbs] set',\n  props<BreadcrumbsState>()\n);\nexport const resetBreadcrumbs = createAction('[breadcrumbs] reset');\n```\n\n## Reducerを定義する\n\n```typescript\nimport { createReducer, on } from '@ngrx/store';\nimport { setBreadcrumbs, resetBreadcrumbs } from './breadcrumb.actions';\nimport { BreadcrumbsState } from './breadcrumb.state'\n\nexport const breadcrumbsFeatureKey = 'Breadcrumbs';\nexport const initialBreadcrumbs:BreadcrumbsState = {\n  breadcrumbs:[]\n};\n\nconst _breadcrumbsReducer = createReducer(\n  initialBreadcrumbs,\n  on(setBreadcrumbs, (state,props) => (\n    {\n      breadcrumbs:[...props.breadcrumbs]\n    }\n  )),\n  on(resetBreadcrumbs, (state) => (\n    {\n      breadcrumbs:[]\n    }\n  )),\n);\n\nexport function breadcrumbsReducer(state:any, action:any) {\n  return _breadcrumbsReducer(state, action);\n}\n```\n\n## selector を定義する\n\n```typescript\nimport { createSelector, createFeatureSelector } from \"@ngrx/store\";\nimport { BreadcrumbsState } from \"./breadcrumb.state\";\nimport { breadcrumbsFeatureKey } from './breadcrumb.reducer';\n\nconst getState = createFeatureSelector<BreadcrumbsState>(breadcrumbsFeatureKey);\n\nexport const selectBreadcrumbs = createSelector(\n  getState,\n  (state) => state\n);\n```\n\n## module でまとめる\n割愛  \n[ソースコードを見て](https://github.com/eeenbnb/karaage-ng-site/blob/master/src/app/ngrx)\n\n\n## Fixme\n2021-05-23  \n酔っぱらいコーディングで動いたのでとりあえずデプロイしてるのでしっかり書く。\n\n\n## 参考\nhttps://ngrx.io/guide/store/walkthrough  \nhttps://dev.classmethod.jp/articles/beginner-ngrx-angular-app/  \nhttps://github.com/nishimura-yuji/ngrx8-tutorial  \n"}