{"2021-05-12":"# styled-componentをやめる話\n\n<div class=\"info\">\n  <p class=\"info__date\">\n    2021/05/12\n  </p>\n  <div class=\"info__tags\">\n    <p class=\"info__tags__one\">Angular</p>\n    <p class=\"info__tags__one\">React.js</p>\n  </div>\n</div>\n\n## はじめに\nなぜstyled-componentをやめるかというと、Angular + React + Scullyという ~~変態~~ ちょっと変わった構成のため。  \nScullyのレンダリングされたHTMLだとデザインが当たらないのでレンダリング済みHTML→SPAの表示の際画面がガタつくことから他の手法にする話。\n\n![ガタツキ](assets/img/2021/05/12/01.gif)\n\n## React の CSS（sass）の当て方\n```tsx\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport './index.scss';\n\nconst App:React.FC = () => {\n  return (\n    <p className=\"hello-text\">\n      hello, world!!\n    </p>\n  );\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n```\nすごく簡単にやるなら上記で行けるっぽい。  \nが、グローバルスコープなcssクラスはあまり扱いたくないので `CSS Modules` を使う。\n\n## AngularでCSS Modulesを使うには\n以下のように記述すると使える。\n\n```typescript\nimport * as style from '../../styles/react-items/card-origin-article.module.css'\n```\n\nがAngularではうまく css module import できないのでカスタムWebpackを定義する必要がある。\n\n```bash\nnpm i -D @angular-builders/custom-webpack\nnpm i -D css-loader style-loader sass-loader sass\n```\n\n```\n\"projects\": {\n  ...\n  \"example-app\": {\n    ...\n    \"architect\": {\n      ...\n      \"build\": {\n        \"builder\": \"@angular-builders/custom-webpack:browser\",\n        \"options\": {\n          \"customWebpackConfig\": {\n           \"path\": \"./extra-webpack.config.js\",\n           \"mergeRules\": {\n             \"externals\": \"replace\"\n           }\n          ...\n          }\n        }\n      },\n      ...\n      \"serve\": {\n        \"builder\": \"@angular-builders/custom-webpack:dev-server\",\n        \"options\": {\n          \"browserTarget\": \"example-app:build\"\n        }\n      },\n      ...\n    }\n  }\n}\n```\n\n`.css` fiileではangular側のビルドツールと競合してうまく通らないので拡張子を変更して対応。\n\n```javascript\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /module\\.wcss$/i,\n        use: [\n          \"style-loader\",\n          \"css-loader\",\n        ],\n      }\n    ],\n  },\n}\n```\n\n\n## 結果\n~~グローバルでsassでコード自体は分けておいて `global.scss` で `@import` するようにする。~~\n`@angular-builders/custom-webpack` を使って `css-loader` で いい感じにカプセル化もできるようになった。\nただ拡張子を `wcss` としているのが解せない。  \n`*.css` ファイルをAngularのコンパイラで拾ってしまうので何かいい方法がないか探す…。\n\n## 参考\n\nhttps://zenn.dev/asano/articles/db9a30c5b1eb46\n\nhttps://github.com/just-jeb/angular-builders/tree/master/packages/custom-webpack\nhttps://qiita.com/niyou0ct/items/290d74d8be86eae4e358\n"}